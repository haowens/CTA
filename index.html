<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>CTA Ridership Changes</title>
    <meta name="description" content="our first data story" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <main id="content">
      <!-- <figure class="sticky">
                    <div id="route"></div>
              </figure>
              <section class="filler">
                <p>Scroll</p>
              </section> -->
      <!-- 
              <section id="scrolly-side">
                <div class="scrolly">
        
                  <article>
                    <div class="step" data-width="10%" data-index="0">
                      <p>Bar is 10%</p>
                    </div>
                    <div class="step" data-width="90%" data-index="1">
                      <p>Bar is 90%</p>
                    </div>
                    <div class="step" data-width="50%" data-index="2">
                      <p>Bar is 50%</p>
                    </div>
                  </article>
        
        
                  <figure class="sticky">
                    <div class="mainfig" id="mainfig">
             
                    </div>
                  </figure>
                </div>
              </section> -->

      <section id="scrolly-overlay">
        <figure class="sticky">
          <div id="route"></div>
        </figure>
        <section class="filler">
          <img src="train.jpg" />
          <p
            style="
              color: black;
              width: 50%;
              font-size: 20px;
              margin-left: 25%;
              margin-top: 5%;
              margin-bottom: 0;
            "
          >
            This story is entirely based on the story
            <a href="https://projects.two-n.com/mta/?utm=website#section-map-16"
              >MTA Ridership Changes due to COVID-19</a
            >
            done by Aucher Serr and Two-N, all credit to them! I thought it was
            a brilliant premise and something to attempt replicating as a
            project for a data visualization design methods class. This story
            instead focuses on my city and public transportation system of
            interest: Chicago and the CTA.
          </p>
          <p
            style="
              color: black;
              width: 50%;
              font-size: 20px;
              margin-left: 25%;
              margin-bottom: 5%;
            "
          >
            The pandemic has completely reshaped the infrastructuer of daily
            communal life in so many ways. The mass movement of an
            imagination-defying amount of tasks online feels like one of the
            most ubiquitous changes. This is, in many ways, huge for
            accessibility--that initial promise of the Internet.
          </p>
        </section>

        <div class="scrolly" id="scrolly">
          <figure class="sticky">
            <div class="mainfig" id="mainfig">
              <!-- <div class="bar-inner"></div> -->
            </div>
          </figure>

          <!--  step text   -->
          <article>
            <div class="step" data-index="0">
              <p>Let's look at monthly ridership since January 2020.</p>
            </div>
            <div class="step" data-index="1">
              <p>Each bar represents a month.</p>
            </div>
            <div class="step" data-index="2">
              <p>
                Chicago was officially on lockdown in 2020 from
                <span
                  style="color: #d9a74c; font-weight: 600; font-size: xx-large"
                  >March 26th</span
                >
                to
                <span
                  style="color: #d9a74c; font-weight: 600; font-size: xx-large"
                  >Jun 3rd</span
                >
              </p>
            </div>
            <div class="step" data-width="50%" data-index="3">
              <p>
                The COVID state of emergency was officially ended on
                <span
                  style="color: #dbc09a; font-weight: 600; font-size: xx-large"
                  >May 11th, 2023</span
                >
              </p>
            </div>
            <div class="step" data-width="50%" data-index="4">
              <p>Let's compare averages of monthly riders</p>
            </div>
            <div class="step" data-width="50%" data-index="5">
              <p>
                <span
                  style="color: #d9a74c; font-weight: 600; font-size: xx-large"
                  >12.3%</span
                >
                of pre-pandemic ridership was maintained during lockdown.<br /><span
                  style="color: #dbc09a; font-weight: 600; font-size: xx-large"
                  >59.9%</span
                >
                of pre-pandemic ridership is active as of late 2023, after the
                official end of the pandemic.
              </p>
            </div>
            <div class="step" data-width="50%" data-index="6">
              <p>Now, let's look at things geographically.</p>
            </div>
            <div class="step" data-width="50%" data-index="7">
              <p>
                Let's look at ridership relative to before the pandemic as
                recorded during
                <span
                  style="color: #d9a74c; font-weight: 600; font-size: xx-large"
                >
                  lockdown</span
                >.
              </p>
            </div>
            <div class="step" data-width="50%" data-index="8">
              <p>How does this break down by neighborhood?</p>
            </div>
            <div class="step" data-width="50%" data-index="9">
              <p>
                There seems to be a significant correlation between the
                neighborhoods income and their relative ridership during
                lockdown.
              </p>
            </div>
            <div class="step" data-width="50%" data-index="10">
              <p>
                Now let's reset, and look at the
                <span
                  style="color: #dbc09a; font-weight: 600; font-size: xx-large"
                  >post-pandemic</span
                >
                ridership breakdown geographically.
              </p>
            </div>
            <div class="step" data-width="50%" data-index="11">
              <p>
                Here is the breakdown by neighborhood of the last few months of
                2023 relative to the pre-pandemic averages of those same months.
              </p>
            </div>
            <div class="step" data-width="50%" data-index="12">
              <p>Let's compare it to our lockdown graph.</p>
            </div>
            <div class="step" data-width="50%" data-index="13">
              <p>
                Let's look at this a different way. The colors of each line are
                scaled by the per capita income of the neighborhood where the
                stop is located.
              </p>
            </div>
            <div class="step" data-width="50%" data-index="14">
              <p>
                The takeaway from this graph seems to mostly be that the drastic
                shift in CTA ridership only really persisted during lockdown. As
                you can see in the left half of the graph, the proportions of
                ridership seems pretty consistent from pre-pandemic averages to
                post-pandemic averages. As you can see from the right half of
                the graph, there seems to be a dramatic color inversion where
                the stops where the darker lines shoot up and then back down
                only for the axis pertaining to relative ridership during
                lockdown.
              </p>
            </div>
          </article>
        </div>
      </section>

      <section class="filler">
        <p>End</p>
      </section>
    </main>

    <!-- <div class='debug'></div> -->
    <script src="https://unpkg.com/d3@5.9.1/dist/d3.min.js"></script>
    <script src="./scrollama.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-tile@1"></script>

    <!-- <script src="helpers.js"></script> -->
    <script src="route.js"></script>
    <script src="barGraph.js"></script>
    <script src="maps.js"></script>
    <script src="parallelScatter.js"></script>

    <script>
      // using d3 for convenience
      var main = d3.select("main");
      var scrolly = main.select("#scrolly");
      var figure = scrolly.select("#mainfig");
      var article = scrolly.select("article");
      var step = article.selectAll(".step");

      // initialize the scrollama
      var scroller = scrollama();

      // generic window resize listener event
      function handleResize() {
        // 1. update height of step elements
        var stepH = Math.floor(window.innerHeight * 1);
        step.style("height", stepH + "px");

        var figureHeight = window.innerHeight / 1;
        var figureMarginTop = (window.innerHeight - figureHeight) / 1;

        figure
          .style("height", figureHeight + "px")
          .style("top", figureMarginTop + "px");

        // 3. tell scrollama to update new element dimensions
        scroller.resize();
      }

      var toolTipState = 'month';

      // scrollama event handlers
      function handleStepEnter(response) {
        console.log(response);
        // response = { element, direction, index }
        let currentIndex = response.index;
        let currentDirection = response.direction;

        // add color to current step only
        step.classed("is-active", function (d, i) {
          return i === response.index;
        });

        // update graphic based on step
        figure.select("p").text(response.index + 1);

        switch(currentIndex) {
          case 0:
            if (currentDirection === "down") {
              drawBarGraphBackground();
              // initializeRoute();
            } else {
              showStop(0);
              // removeBarChart();
            }
          case 1: 
            if (currentDirection === "down") {
              toolTipState = 'month';
              showStop(1);
              // addBarChart();
            } else {
              showStop(1);
              // removeLockdownLines();
            }
        }

        // if (response.index === 0) {
        //   if (response.direction === "down") {
        //   } else {
        //     showStop(0);
        //     removeBarChart();
        //   }
        // } else if (response.index === 1) {
        //   if (response.direction === "down") {
        //     showStop(1);
        //     addBarChart();
        //   } else {
        //     showStop(1);
        //     removeLockdownLines();
        //   }
        // } else if (response.index === 2) {
        //   if (response.direction === "down") {
        //     showStop(2);
        //       lockdownLines();
        //   } else {
        //     showStop(2);
        //       removePostLockdownLines();
        //   }
        // } else if (response.index === 3) {
        //   if (response.direction === "down") {
        //     showStop(3);
        //       postLockdownLines();
        //   } else {
        //     showStop(3);
        //       removeAvgs();
        //       drawYearLabels();
        //       addBarChart();
        //       lockdownLines();
        //       postLockdownLines();
        //   }
        // } else if (response.index === 4) {
        //   if (response.direction === "down") {
        //     showStop(4);
        //       removeLabelsCompareAvgs();
        //   } else {
        //     // sentences();
        //   }
        // } else if (response.index === 5) {
        //   if (response.direction === "down") {
        //     showStop(5);
        //       removeBarsAndDrawMap();
        //   } else {
        //     showStop(5);
        //       undoColor();
        //   }
        // } else if (response.index === 6) {
        //   if (response.direction === "down") {
        //     showStop(6);
        //       lockdownColors();
        //   } else {
        //     // themes();
        //   }
        // }
        // } else if (response.index === 6) {
        //   if (response.direction === "down") {
        //     showStop(6);
        //       lockdownColors();
        //   } else {
        //     // themes();
        //   }
        // } else if (response.index === 6) {
        //   if (response.direction === "down") {
        //     showStop(6);
        //       lockdownColors();
        //   } else {
        //     // themes();
        //   }
        // } else if (response.index === 6) {
        //   if (response.direction === "down") {
        //     showStop(6);
        //       lockdownColors();
        //   } else {
        //     // themes();
        //   }
        // } else if (response.index === 6) {
        //   if (response.direction === "down") {
        //     showStop(6);
        //       lockdownColors();
        //   } else {
        //     // themes();
        //   }
        // } else if (response.index === 6) {
        //   if (response.direction === "down") {
        //     showStop(6);
        //       lockdownColors();
        //   } else {
        //     // themes();
        //   }
        // } else if (response.index === 6) {
        //   if (response.direction === "down") {
        //     showStop(6);
        //       lockdownColors();
        //   } else {
        //     // themes();
        //   }
        // } else if (response.index === 6) {
        //   if (response.direction === "down") {
        //     showStop(6);
        //       lockdownColors();
        //   } else {
        //     // themes();
        //   }
        // } else if (response.index === 6) {
        //   if (response.direction === "down") {
        //     showStop(6);
        //       lockdownColors();
        //   } else {
        //     // themes();
        //   }
        // }
      }

      function init() {
        // 1. force a resize on load to ensure proper dimensions are sent to scrollama
        handleResize();
        initializeRoute();
        // drawBarGraphBackground();

        // 2. setup the scroller passing options
        // 		this will also initialize trigger observations
        // 3. bind scrollama event handlers (this can be chained like below)
        scroller
          .setup({
            step: "#scrolly article .step",
            offset: 0.33,
            debug: false,
          })
          .onStepEnter(handleStepEnter);
      }
      // kick things off
      init();
    </script>
  </body>
</html>
