<!DOCTYPE html>
<html lang="en" data-version="1528749026774">
  <head>
    <title>Easier scrollytelling with position sticky</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="description"
      content="Leaning on CSS to simplify the process."
    />
    <meta
      name="news_keywords"
      content="scrollytelling, position, sticky, css, graphic, interactive, data"
    />

    <link
      rel="canonical"
      href="https://pudding.cool/process/scrollytelling-sticky/"
    />
    <link rel="stylesheet" href="style.css" />

    <!-- boilerplate.css -->

    <script src="https://d3js.org/d3.v6.js"></script>
    <script src="https://unpkg.com/enter-view"></script>
    <!-- <script src="https://unpkg.com/d3@5.4.0/dist/d3.min.js"></script> -->
    <script src="https://unpkg.com/stickyfilljs@2.0.5/dist/stickyfill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-tile@1"></script>
  </head>

  <body class="tk-publico">
    <main id="content">
      <!-- <figure class="sticky">
            <div id="route"></div>
      </figure>
      <section class="filler">
        <p>Scroll</p>
      </section> -->
      <!-- 
      <section id="scrolly-side">
        <div class="scrolly">

          <article>
            <div class="step" data-width="10%" data-index="0">
              <p>Bar is 10%</p>
            </div>
            <div class="step" data-width="90%" data-index="1">
              <p>Bar is 90%</p>
            </div>
            <div class="step" data-width="50%" data-index="2">
              <p>Bar is 50%</p>
            </div>
          </article>


          <figure class="sticky">
            <div class="mainfig" id="mainfig">
     
            </div>
          </figure>
        </div>
      </section> -->

      <section id="scrolly-overlay">
        <figure class="sticky">
          <div id="route"></div>
        </figure>
        <section class="filler">
          <img src="train.jpg" />
          <p
            style="
              color: black;
              width: 50%;
              font-size: 20px;
              margin-left: 25%;
              margin-top: 5%;
              margin-bottom: 0;
            "
          >
            This story is entirely based on the story
            <a href="https://projects.two-n.com/mta/?utm=website#section-map-16"
              >MTA Ridership Changes due to COVID-19</a
            >
            done by Aucher Serr and Two-N, all credit to them! I thought it was
            a brilliant premise and something to attempt replicating as a
            project for a data visualization design methods class. This story
            instead focuses on my city and public transportation system of
            interest: Chicago and the CTA.
          </p>
          <p
            style="
              color: black;
              width: 50%;
              font-size: 20px;
              margin-left: 25%;
              margin-bottom: 5%;
            "
          >
            The pandemic has completely reshaped the infrastructuer of daily
            communal life in so many ways. The mass movement of an
            imagination-defying amount of tasks online feels like one of the
            most ubiquitous changes. This is, in many ways, huge for
            accessibility--that initial promise of the Internet.
          </p>
        </section>

        <div class="scrolly">
          <figure class="sticky">
            <div class="mainfig" id="mainfig">
              <!-- <div class="bar-inner"></div> -->
            </div>
          </figure>

          <!--  step text   -->
          <article id="hard">
            <div class="step" data-width="10%" data-index="0">
              <p>Let's look at monthly ridership since January 2020.</p>
            </div>
            <div class="step" data-width="90%" data-index="1">
              <p>Each bar represents a month. Hover over the bar to get specific details.</p>
            </div>
            <div class="step" data-width="50%" data-index="2">
              <p>
                Chicago was officially on lockdown in 2020 from
                <span
                  style="color: #d9a74c; font-weight: 600; font-size: xx-large"
                  >March 26th</span
                >
                to
                <span
                  style="color: #d9a74c; font-weight: 600; font-size: xx-large"
                  >Jun 3rd</span
                >
              </p>
            </div>
            <div class="step" data-width="50%" data-index="3">
              <p>
                The COVID state of emergency was officially ended on
                <span
                  style="color: #dbc09a; font-weight: 600; font-size: xx-large"
                  >May 11th, 2023</span
                >
              </p>
            </div>
            <div class="step" data-width="50%" data-index="4">
              <p>Let's compare averages of monthly riders</p>
            </div>
            <div class="step" data-width="50%" data-index="5">
              <p>
                <span
                  style="color: #d9a74c; font-weight: 600; font-size: xx-large"
                  >12.3%</span
                >
                of pre-pandemic ridership was maintained during lockdown.<br /><span
                  style="color: #dbc09a; font-weight: 600; font-size: xx-large"
                  >59.9%</span
                >
                of pre-pandemic ridership is active as of late 2023, after the
                official end of the pandemic.
              </p>
            </div>
            <div class="step" data-width="50%" data-index="6">
              
            </div>
            </article>
            <article>
              <div class="step" data-width="50%" data-index="7">
                <p>Now, let's look at things geographically.</p>
              </div>
              <div class="step" data-width="50%" data-index="8">
                <p>
                  Let's look at ridership relative to before the pandemic as
                  recorded during
                  <span
                    style="color: #d9a74c; font-weight: 600; font-size: xx-large"
                  >
                    lockdown</span
                  >.
                </p>
              </div>
              <div class="step" data-width="50%" data-index="9">
                <p>How does this break down by neighborhood?</p>
              </div>
              <div class="step" data-width="50%" data-index="10">
                <p>
                  There seems to be a significant correlation between the
                  neighborhoods income and their relative ridership during
                  lockdown.
                </p>
              </div>
              <div class="step" data-width="50%" data-index="11">
                <p>
                  Now let's reset, and look at the
                  <span
                    style="color: #dbc09a; font-weight: 600; font-size: xx-large"
                    >post-pandemic</span
                  >
                  ridership breakdown geographically.
                </p>
              </div>
              <div class="step" data-width="50%" data-index="12">
                <p>
                  Here is the breakdown by neighborhood of the last few months of
                  2023 relative to the pre-pandemic averages of those same months.
                </p>
              </div>
              <div class="step" data-width="50%" data-index="13">
                <p>Let's compare it to our lockdown graph.</p>
              </div>
            </article>
            <article>
            <div class="step" data-width="50%" data-index="14">
              <p>
                Let's look at this a different way. The colors of each line are
                scaled by the per capita income of the neighborhood where the
                stop is located.
              </p>
            </div>
            <div class="step" data-width="50%" data-index="15">
              <p>
                The takeaway from this graph seems to mostly be that the drastic
                shift in CTA ridership only really persisted during lockdown. As
                you can see in the left half of the graph, the proportions of
                ridership seems pretty consistent from pre-pandemic averages to
                post-pandemic averages. As you can see from the right half of
                the graph, there seems to be a dramatic color inversion where
                the stops where the darker lines shoot up and then back down
                only for the axis pertaining to relative ridership during
                lockdown.
              </p>
            </div>
          </article>
        </div>
      </section>

      <section class="filler">
        <p>End</p>
      </section>
    </main>

    <script src="helpers.js"></script>
    <script src="route.js"></script>
    <script src="barGraph.js"></script>
    <script src="maps.js"></script>
    <script src="parallelScatter.js"></script>

    <script>
      const container1 = d3.select("#scrolly-overlay");
      const stepSel1 = container1.selectAll(".step");

      function init1() {
        Stickyfill.add(d3.select(".sticky").node());
        initializeRoute();
        drawBarGraphBackground();

        enterView({
          selector: stepSel1.nodes(),
          offset: 0.5,
          enter: (el) => {
            const index = +d3.select(el).attr("data-index");
            console.log(index);
            stepSel1.classed("is-active", (d, i) => i === index);
            if (index === 0) {
            } else if (index === 1) {
              showStop(1);
              addBarChart();
            } else if (index === 2) {
              showStop(2);
              lockdownLines();
              // removeBarsAndDrawMap()
            } else if (index === 3) {
              showStop(3);
              postLockdownLines();
            } else if (index === 4) {
              showStop(4);
              removeLabelsCompareAvgs();
            } else if (index === 6) {
              removeBars()
            } else if (index === 7) {
              showStop(5);
              removeBarsAndDrawMap();
            } else if (index === 8) {
              showStop(6);
              lockdownColors();
            } else if (index === 9) {
              showStop(7);
              drawNeighborhoods();
            } else if (index === 11) {
              showStop(8);
              removeNeighborhoods();
              undoColor();
            } else if (index === 12) {
              showStop(9);
              postPanColors();
            } else if (index === 13) {
              showStop(10);
              drawPostPanNeighborhoods();
            } else if (index === 14) {
              showStop(11);
              parallelScatter();
            }
          },
          exit: (el) => {
            let index = +d3.select(el).attr("data-index");
            index = Math.max(0, index - 1);
            if (index === 0) {
              showStop(0);
              removeBarChart();
            } else if (index === 1) {
              showStop(1);
              removeLockdownLines();
            } else if (index === 2) {
              showStop(2);
              removePostLockdownLines();
            } else if (index === 3) {
              showStop(3);
              removeAvgs();
              drawYearLabels();
              addBarChart();
              lockdownLines();
              postLockdownLines();
            } else if (index === 5) {
              showStop(4);
              removeMapBacktoAvgs();
            } else if (index === 7) {
              showStop(5);
              undoColor();
            } else if (index === 8) {
              showStop(6);
              removeNeighborhoods();
              drawGradient(0.02, 0.42);
            } else if (index === 10) {
              showStop(7);
              drawNeighborhoods();
              lockdownColors();
            } else if (index === 11) {
              showStop(8);
              undoColor();
            } else if (index === 12) {
              showStop(9);
              removeNeighborhoods();
              drawGradient(0.17, 0.92);
            } else if (index === 13) {
              showStop(10);
              removeBarsAndDrawMap();
              postPanColors();
              drawPostPanNeighborhoods();
            }

            stepSel1.classed("is-active", (d, i) => i === index);
          },
        });
      }

      init1();

      //   const container2 = d3.select("#scrolly-overlay");
      //   const stepSel2 = container2.selectAll(".step");

      //   function updateChart2(index) {
      //     const sel = container2.select(`[data-index='${index}']`);
      //     const width = sel.attr("data-width");
      //     stepSel2.classed("is-active", (d, i) => i === index);
      //     container2.select(".bar-inner").style("width", width);
      //   }

      //   function init2() {
      //     Stickyfill.add(d3.select(".sticky").node());

      //     enterView({
      //       selector: stepSel2.nodes(),
      //       offset: 0.5,
      //       enter: (el) => {
      //         const index = +d3.select(el).attr("data-index");
      //         updateChart2(index);
      //       },
      //       exit: (el) => {
      //         let index = +d3.select(el).attr("data-index");
      //         index = Math.max(0, index - 1);
      //         updateChart2(index);
      //       },
      //     });
      //   }

      //   init2();
    </script>
  </body>
</html>
